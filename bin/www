#!/usr/bin/env node
// â†‘ Ð¨ÐµÐ±Ð°Ð½Ð³: Ð½Ð° Unix-Ð¿Ð¾Ð´Ð¾Ð±Ð½Ñ‹Ñ… ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ñ… Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð» ÐºÐ°Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.
//   ÐÐ° Windows Ð½Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½, Ð½Ð¾ Ð¾ÑÑ‚Ð°Ð²Ð¸Ð¼ â€” Ð½Ðµ Ð¼ÐµÑˆÐ°ÐµÑ‚.

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ ÑƒÑ‡ÐµÐ±Ð½Ñ‹Ð¹ Ð»Ð°ÑƒÐ½Ñ‡ÐµÑ€ HTTP-ÑÐµÑ€Ð²ÐµÑ€Ð°.
// Ð”ÐµÐ»Ð°ÐµÑ‚ 3 Ð²ÐµÑ‰Ð¸:
//   1) Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚ PORT Ð¸Ð· .env,
//   2) ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ HTTP-ÑÐµÑ€Ð²ÐµÑ€ Ð½Ð° Ð±Ð°Ð·Ðµ Ð½Ð°ÑˆÐµÐ³Ð¾ Express-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ,
//   3) Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ð¿Ñ€Ð¾ÑÐ»ÑƒÑˆÐ¸Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ñ€Ñ‚Ð° Ð¸ ÐºÑ€Ð°ÑÐ¸Ð²Ð¾ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÐµÑ‚ Ð°Ð´Ñ€ÐµÑ.
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

require('dotenv').config();   // ÐŸÐ¾Ð´Ñ‚ÑÐ³Ð¸Ð²Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð· .env (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, PORT=3000)

const http = require('http'); // ÐÐ°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ HTTP-Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Node.js
const app = require('../app'); // ÐÐ°ÑˆÐµ Express-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ (ÑÐ¼. app.js)

// 1) ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ Ð¿Ð¾Ñ€Ñ‚. Ð•ÑÐ»Ð¸ PORT Ð½Ðµ Ð·Ð°Ð´Ð°Ð½ â€” Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ 3000.
const port = parseInt(process.env.PORT, 10) || 3000;
app.set('port', port); // ÐÐµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾, Ð½Ð¾ ÑƒÐ´Ð¾Ð±Ð½Ð¾: ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ñ€Ñ‚ Ð² Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ñ… Express

// 2) Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ HTTP-ÑÐµÑ€Ð²ÐµÑ€ Ð¸ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‘Ð¼ ÐµÐ¼Ñƒ Express-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ ÐºÐ°Ðº Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð².
const server = http.createServer(app);

// 3) Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¿Ñ€Ð¾ÑÐ»ÑƒÑˆÐ¸Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ñ€Ñ‚Ð°.
//    ÐšÐ¾Ð³Ð´Ð° ÑÐµÑ€Ð²ÐµÑ€ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÑ‚Ð°Ñ€Ñ‚ÑƒÐµÑ‚ â€” Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ Ð´Ñ€ÑƒÐ¶ÐµÐ»ÑŽÐ±Ð½Ñ‹Ð¹ Ð»Ð¾Ð³ Ñ Ð°Ð´Ñ€ÐµÑÐ¾Ð¼.
server.listen(port, () => {
    // HOST Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð½Ðµ Ð½ÑƒÐ¶ÐµÐ½. ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ ÑÐ»ÑƒÑˆÐ°ÐµÐ¼ Ð½Ð° 0.0.0.0 (Ð²ÑÐµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑ‹),
    // Ð½Ð¾ Ð´Ð»Ñ ÐºÑ€Ð°ÑÐ¸Ð²Ð¾Ð³Ð¾ Ð»Ð¾Ð³Ð° Ð²Ñ‹Ð²ÐµÐ´ÐµÐ¼ 'localhost', ÐµÑÐ»Ð¸ HOST Ð½Ðµ Ð·Ð°Ð´Ð°Ð½.
    const host = process.env.HOST || 'localhost';
    console.log(`ðŸš€ Server listening on http://${host}:${port}`);
    // ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ°: ÐµÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑˆÑŒ nodemon, Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð±Ñ€Ð°Ñ‚ÑŒ 'rs' Ð² ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ.
});

// ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð·Ð°Ð¿ÑƒÑÐºÐ° (ÑÐ°Ð¼Ñ‹Ðµ Ñ‡Ð°ÑÑ‚Ñ‹Ðµ ÐºÐµÐ¹ÑÑ‹).
server.on('error', (err) => {
    // EACCES â€” Ð½Ðµ Ñ…Ð²Ð°Ñ‚Ð°ÐµÑ‚ Ð¿Ñ€Ð°Ð² (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¿Ð¾Ñ€Ñ‚ < 1024 Ð½Ð° Unix Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ sudo/Ð°Ð´Ð¼Ð¸Ð½Ð°)
    if (err.code === 'EACCES') {
        console.error(`Port ${port} requires elevated privileges`);
        process.exit(1);
    }
    // EADDRINUSE â€” Ð¿Ð¾Ñ€Ñ‚ ÑƒÐ¶Ðµ Ð·Ð°Ð½ÑÑ‚ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¾Ð¹
    if (err.code === 'EADDRINUSE') {
        console.error(`Port ${port} is already in use`);
        process.exit(1);
    }
    // Ð›ÑŽÐ±Ð°Ñ Ð´Ñ€ÑƒÐ³Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° â€” Ð²Ñ‹Ð²ÐµÐ´ÐµÐ¼ Ð¸ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð¼ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ.
    console.error(err);
    process.exit(1);
});
